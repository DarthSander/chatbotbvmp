<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Geboorteplan-agent</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* ---------- palet & basis ---------- */
    :root {
      --rose: #d5848d;
      --rose-light: #e8a8b0;
      --sage: #8cbf9d;
      --sage-light: #cfe6d0;
      --cream: #fef9f5;
      --beige: #fdf7f2;
      --rose-sub: #fbeaec;
      --text: #2d3436;
      --text-light: #636e72;
      --grad-main: linear-gradient(135deg, var(--cream), var(--beige) 50%, var(--rose-sub) 100%);
      --grad-rose: linear-gradient(135deg, var(--rose), var(--rose-light));
      --shadow: 0 6px 22px rgba(0, 0, 0, .1);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Inter, system-ui, sans-serif;
      background: var(--grad-main);
      color: var(--text);
      line-height: 1.55;
    }
    #layout {
      display: flex;
      gap: 24px;
      max-width: 1280px;
      margin: auto;
      padding: 24px;
      height: 100%;
      box-sizing: border-box;
    }
    @media (max-width: 900px) {
      #layout { flex-direction: column; }
    }

    /* ---------- chat ---------- */
    #chat-col {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 24px;
      background: rgba(255,255,255,.6);
      border-radius: 24px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.4);
      box-sizing: border-box;
      height: 100%;
    }
    #chatbox { flex: 1; overflow-y: auto; padding: 8px }
    .bubble { padding:12px 18px; margin:10px 0; border-radius:18px; max-width:88%; animation:fade .25s }
    .bubble.bot { background:#fff; border:1px solid rgba(0,0,0,.05) }
    .bubble.user { background:var(--grad-rose); color:#fff; margin-left:auto; border-bottom-right-radius:6px }
    @keyframes fade { from {opacity:0;transform:translateY(6px);} to{opacity:1;transform:translateY(0);} }
    .typing { display:inline-block; width:32px; height:8px }
    .typing span { display:inline-block; width:6px; height:6px; margin:0 2px; background:#888; border-radius:50%; animation:blink 1.2s infinite }
    .typing span:nth-child(2){animation-delay:.2s;} .typing span:nth-child(3){animation-delay:.4s;}
    @keyframes blink {0%,80%,100%{opacity:.2;}40%{opacity:1;}}
    textarea {width:100%;min-height:90px;padding:16px 20px;font-size:16px;border-radius:18px;border:1px solid rgba(0,0,0,.15);box-sizing:border-box;}
    button#send {align-self:flex-end;margin-top:6px;padding:12px 24px;border:none;border-radius:18px;background:var(--grad-rose);color:#fff;font-size:16px;cursor:pointer}

    /* ---------- sidebar container ---------- */
    #sidebar-flip-container {
      flex: 2;
      position: relative;  /* voor loader-overlay */
    }
    .flip-container {
      perspective: 1000px;
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease;
    }
    .flip-container.show-back  { transform: rotateY(-180deg); }
    .flip-container.show-third { transform: rotateY(-360deg); }

    .sidebar-face {
      position: absolute; top:0; left:0;
      width:100%; height:100%;
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
      background: rgba(255,255,255,.6);
      border-radius:24px; box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.4);
      padding:24px; box-sizing:border-box;
      overflow-y:auto;
      display:flex; flex-direction:column;
    }

    /* Thema-selectie = front */
    .sidebar-face.front  { transform: rotateY(0deg); z-index:3; }
    /* Onderwerpen = back */
    .sidebar-face.back   { transform: rotateY(-180deg); z-index:2; }
    /* Vragen & Antwoorden = third */
    .sidebar-face.third  { transform: rotateY(-360deg); z-index:1; }

    /* loader-overlay */
    #sidebar-loader {
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:rgba(255,255,255,0.8);
      display:flex; align-items:center; justify-content:center; z-index:4;
    }
    #sidebar-loader .spinner {
      border:4px solid rgba(0,0,0,0.1);
      border-top-color:var(--rose);
      border-radius:50%; width:32px; height:32px;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg);}}

    .back-button {
      background:none; border:none; color:var(--rose);
      font-size:1rem; cursor:pointer; margin-bottom:16px;
      align-self:flex-start;
    }

    /* Thema- en topic-view */
    #q-title { margin-bottom:6px; color:var(--text-light); font-weight:600; }
    #q-options { display:flex; flex-wrap:wrap; gap:12px 14px; margin-bottom:12px; }
    .theme-chip, .topic-chip {
      padding:8px 16px; border-radius:9999px; font-size:14px; cursor:pointer; user-select:none; transition:.25s;
    }
    .theme-chip {
      border:1px solid var(--rose); color:var(--rose); background:#fff;
    }
    .theme-chip:hover { background:var(--grad-rose); color:#fff; }
    .theme-chip.selected { background:linear-gradient(135deg,var(--sage),var(--sage-light));color:#fff;border:none;padding-right:28px; }
    .edit-bar {
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      font-size:.85rem; cursor:pointer; opacity:.8;
    }
    .edit-bar:hover { opacity:1; }

    .topic-chip {
      border:1px solid var(--sage); color:var(--sage); background:rgba(140,191,157,.12);
    }
    .topic-chip.selected { background:linear-gradient(135deg,var(--sage),var(--sage-light)); color:#fff; border:0; }
    .topic-chip[data-desc]:hover::after {
      content:attr(data-desc);
      position:absolute; left:50%; transform:translateX(-50%);
      top:110%; background:var(--rose-light); color:#fff;
      padding:6px 10px; border-radius:8px; white-space:nowrap; font-size:12px; box-shadow:0 4px 12px rgba(0,0,0,.15); z-index:20;
    }
    .topic-chip[data-desc]:hover::before {
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      top:100%; border:6px solid transparent; border-top-color:var(--rose-light);
    }
    #q-topic-options { display:flex; flex-wrap:wrap; gap:8px; }

    .confirm-button {
      margin-top:auto; width:100%; padding:12px 0; border:none; border-radius:18px;
      background:var(--grad-rose); color:#fff; font-size:16px; cursor:pointer;
    }
    .confirm-button:disabled { opacity:.5; cursor:not-allowed; }

    /* QA-log (in front-pane) */
    #qa-log { flex:1; overflow-y:auto; padding:8px; margin-top:8px; }

    /* Derde paneel: Vragen & Antwoorden */
    #sidebar-third h5 { margin-top:0; font-size:1rem; font-weight:600; }
    #q-and-a { flex:1; overflow-y:auto; padding:8px; }
    .qa-item { margin-bottom:16px; }
    .qa-item .label { font-size:.85rem; color:var(--text-light); margin-bottom:4px; }
    .qa-item .question { font-weight:600; margin-bottom:2px; }
    .qa-item .answer   { margin-left:8px; }
  </style>
</head>
<body>

<main id="layout">
  <!-- Chatkolom -->
  <div id="chat-col">
    <div id="chatbox"></div>
    <div id="choices"></div>
    <textarea id="input" placeholder="Typ je bericht…"></textarea>
    <button id="send">Verstuur</button>
  </div>

  <!-- Sidebar met 3 panels -->
  <div id="sidebar-flip-container">
    <!-- loader-overlay -->
    <div id="sidebar-loader" style="display:none;">
      <div class="spinner"></div>
    </div>

    <div class="flip-container">
      <!-- 1. Front: thema’s + QA-log -->
      <aside class="sidebar-face front" id="sidebar-front">
        <h4 id="q-title"></h4>
        <div id="q-options"></div>
        <hr>
        <h5>Antwoorden</h5>
        <div id="qa-log"></div>
      </aside>

      <!-- 2. Back: onderwerpen -->
      <aside class="sidebar-face back" id="sidebar-back">
        <button id="back-to-themes" class="back-button">← Thema’s</button>
        <h4 id="back-title" style="margin-bottom:6px; color: var(--text-light); font-weight:600;"></h4>
        <div id="q-topic-options"></div>
        <button id="confirm-topics" class="confirm-button" disabled>Bevestig onderwerpen →</button>
      </aside>

      <!-- 3. Third: Vragen & Antwoorden -->
      <aside class="sidebar-face third" id="sidebar-third">
        <button id="back-to-topics" class="back-button">← Onderwerpen</button>
        <h5>Vragen & Antwoorden</h5>
        <div id="q-and-a"></div>
      </aside>
    </div>
  </div>
</main>

<script>
  console.log('[init] frontend initialiseren');
  const API = "https://chatbotbvmp.onrender.com/agent";
  let sessionId = sessionStorage.getItem("agentSession") || null;
  let currentTheme=null, currentTopic=null;

  const chatbox=document.getElementById("chatbox");
  function addMsg(role,md){ /* onveranderd */ }

  async function callAgent(message){
    /* onveranderd */
  }

  /* Sidebar-loader helpers */
  function showLoader(){ document.getElementById('sidebar-loader').style.display='flex'; }
  function hideLoader(){ document.getElementById('sidebar-loader').style.display='none'; }

  /* Flip-helpers */
  const container=document.querySelector('.flip-container');
  function showFront(){ container.className='flip-container'; }
  function showBack(){ container.className='flip-container show-back'; }
  function showThird(){ container.className='flip-container show-third'; }

  /* renderThemes, renderTopicChips… (ongewijzigd) */

  /* Terugknoppen */
  document.getElementById("back-to-themes").onclick = async () => {
    console.log('[back-to-themes]'); showLoader();
    await new Promise(r=>setTimeout(r,300)); // simuleer laadtijd
    hideLoader(); showFront();
  };
  document.getElementById("back-to-topics").onclick = () => {
    console.log('[back-to-topics]');
    showBack();
  };

  /* Na bevestigen onderwerpen: open derde paneel */
  async function confirmTopics(){
    /* silent registreren… */
    showThird();
    /* laad Q&A in derde paneel */
    const qa = /* lees uit je state: thema, topics, vragen&antwoorden */;
    const container=document.getElementById('q-and-a');
    container.innerHTML='';
    qa.forEach(item=>{
      const div=document.createElement('div');
      div.className='qa-item';
      div.innerHTML=`
        <div class="label">Thema: ${item.theme}</div>
        <div class="label">Onderwerp: ${item.topic}</div>
        <div class="question">${item.question}</div>
        <div class="answer">${item.answer}</div>
      `;
      container.appendChild(div);
    });
  }
  document.getElementById("confirm-topics").onclick = confirmTopics;

  /* callAndRender: na stage==="choose_topic" → showBack() + hideLoader() + renderTopicChips */
  async function callAndRender(msg){
    /* na bot-reply */
    if(data.stage==="choose_theme"){
      /* ... */
      showFront();
    }
    if(data.stage==="choose_topic"){
      showLoader();
      await new Promise(r=>setTimeout(r,300));
      hideLoader();
      showBack();
      /* renderTopicChips enz. */
    }
  }

  /* start */
  console.log('[init] welkom'); addMsg("bot","Welkom …");
  /* TaskAgent… ongewijzigd */
</script>
</body>
</html>